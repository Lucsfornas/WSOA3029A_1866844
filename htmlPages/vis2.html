<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data visualisation 2</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,200;0,300;0,400;0,500;0,700;1,500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/d3-axis.v2.min.js"></script>


</head>

<body>
    <nav>
        <div class="logo">
            <h4>The Guide</h4>
        </div>
        <ul class="navlinks">
            <li>
                <a href="../index.html">Home</a>
            </li>
            <li>
                <a href="./About.html">About</a>
            </li>
            <li>
                <a href="./WSOAblogs.html">WSOA3029 Blogs</a>
            </li>
            <li>
                <a href="./newdatavisualisation.html">Data Visualisations</a>
            </li>
        </ul>
        <div class="burger">
            <div class="line1"></div>
            <div class="line2"></div>
            <div class="line3"></div>
        </div>
    </nav>


    <main class="backgroundcol">
        <br>
        <h1 class="orange">This is my second data visualisation</h1>
        <br>
        <p>you can use these links to navigate to my different Visualisations</p>
        <div class="blogbuttons">
            <button><a href="./vis1.html" alt='Broken Link'>data vis 1</a></button>
            <button><a href="./vis2.html" alt='Broken Link'>data vis 2</a></button>
            <button><a href="./vis3.html" alt='Broken Link'>data vis 3</a></button>
            <button><a href="./creativeApi.html" alt='Broken Link'>data vis 4 (extra)</a></button>
        </div>
        <article>
            <h2 class="orange">This is my second Data Visualisation made using D3.js libraries</h2>
            <br>
            <p>This data visualisation was made as an interactable graph, by checking and unchecking the boxes displayed
                on the left the bars will either appear or dissapear. this graph uses dummy data to represent the bars
                and not the actual covid-19 data, the covid statistics are too large to fit on the graph, i used this
                graph as an example of graph interactivity instead.</p>
            <br>
            <div id="appvis2">
                <div class="chartvis2">
                    <svg class="graph2" id="visualisation2"></svg>
                </div>
                <div id="datavis2">
                    <ul></ul>
                </div>
            </div>
        </article>
    </main>


    <script>
        let covid19data = [
            { id: 'd1', type: 'totalconfirmed', value: 15 }, /*15085083 */
            { id: 'd2', type: 'totalactive', value: 12 }, /*5361549 */
            { id: 'd3', type: 'totalcritical', value: 11 }, /* 63786*/
            { id: 'd4', type: 'totaldeaths', value: 6 }, /*618504 */
            { id: 'd5', type: 'totalrecovered', value: 5 }, /*9105030 */
        ]
        const margins = { top: 20, bottom: 10 };
        const chart_width = 600;
        const chart_height = 400 - margins.top - margins.bottom;

        let selecteddata = covid19data;

        const x = d3.scaleBand().rangeRound([0, chart_width]).padding(0.1);
        const y = d3.scaleLinear().range([chart_height, 0]);

        const chartcontainer = d3
            .select('#visualisation2')
            .attr('width', chart_width)
            .attr('height', chart_height + margins.top + margins.bottom);

        x.domain(covid19data.map((d) => d.type));
        y.domain([0, d3.max(covid19data, d => d.value) + 3]);

        const chart = chartcontainer.append('g');

        chart
            .append('g')
            .call(d3.axisBottom(x))
            .attr('transform', `translate(0, ${chart_height})`)
            .attr('color', '#4f009e');

        function renderchart() {

            chart
                .selectAll('.bar')
                .data(selecteddata, data => data.id)
                .enter()
                .append('rect')
                .classed('bar', true)
                .attr('width', x.bandwidth())
                .attr('height', (data) => chart_height - y(data.value))
                .attr('x', (data) => x(data.type))
                .attr('y', (data) => (data.value));


            chart.selectAll('.bar').data(selecteddata, data => data.id).exit().remove();

            chart.selectAll('.label')
                .data(selecteddata, data => data.id)
                .enter()
                .append('text')
                .text((data) => data.value)
                .attr('x', data => x(data.type) + x.bandwidth() / 2)
                .attr('y', data => (data.value) - 20)
                .attr('text-anchor', 'middle')
                .classed('label', true);

            chart.selectAll('.label').data(selecteddata, data => data.id).exit().remove();
        }

        renderchart();

        let unselectedid = [];

        const listitems = d3
            .select('#datavis2')
            .select('ul')
            .selectAll('li')
            .data(covid19data)
            .enter()
            .append('li');

        listitems.append('span').text((data) => data.type);

        listitems
            .append('input')
            .attr('type', 'checkbox')
            .attr('checked', true)
            .on('change', (data) => {
                if (unselectedid.indexOf(data.id) === -1) {
                    unselectedid.push(data.id);
                } else {
                    unselectedid = unselectedid.filter(id => id !== data.id);
                }
                selecteddata = covid19data.filter((d) => unselectedid.indexOf(d.id) == -1);
                renderchart();
            });
    </script>



    <script src="../movement.js"></script>
</body>

</html>